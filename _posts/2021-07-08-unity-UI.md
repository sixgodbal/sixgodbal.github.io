---
layout: post
title:  "Unity_Problems"
date:   2021-07-08 12:10:54
categories: Unity
tags: 编程
excerpt: true
---


* content
{:toc}


### 1.场景与UI点击事件自定义响应 - 特殊处理方式

```
//执行所有 Raycast触发的xxx事件
public void ExecuteAll(PointerEventData eventData) {
    List<RaycastResult> results = new List<RaycastResult>();
    EventSystem.current.RaycastAll(eventData, results);
    foreach (RaycastResult result in results) {
        if (result.gameObject != gameObject) {
            ExecuteEvents.Execute(result.gameObject, eventData, ExecuteEvents.pointerClickHandler);
        }
    }
}
//点击到的是否是UI _raycaster = FindObjectOfType<GraphicRaycaster>();
private bool IsUI() {
    PointerEventData data = new PointerEventData(EventSystem.current);
    data.pressPosition = Input.mousePosition;
    data.position = Input.mousePosition;
	List<RaycastResult> results = new List<RaycastResult>();
    _raycaster.Raycast(data, results);
    return results.Count > 0;
}
```

### 2.UGUI Image显示简析

```
图像显示：在方法OnPopulateMesh(VertexHelper vh)内
1.传入顶点vh.AddVert() //自动按传入顺序 分配顶点id 从1开始
2.每三个顶点一组传入三角形vh.AddTriangle() //顺时针为正方向
3.顶点信息传入GPU进行绘制

点击事件:IsRaycastLocationValid() //可重载实现根据位置判断是否触发
```

### 3.Particle System特效遮罩

```
1.调整粒子Render中Masking参数
2.父物体遮罩添加maskSprite组件
```

### 4.重建

```
(OnEnable() OnDisable() 导致重建所有)
流程: 修改颜色->顶点章标记->添加到章队列->下一帧重绘此队列
```

### 5.UGUI合批规则

```
遍历UI->根据深度值、材质、Texture、Render Order生成数组->数组排序->剔除深度值为-1的组件->相邻元素判断合批
(Text组件根据字体Render进行判断是否合批)
Mask:
(不同Mask的子物体可合批)(会绘制被裁剪部分)
(不能与外部合批[自动添加一个材质])
(会产生2DC[添加、还原模板缓存分别一次][根据模板缓存控制像素显示])
RectMask2D:
(不同Mask的子物体不能合批)(被裁剪部分不会被绘制)
```

